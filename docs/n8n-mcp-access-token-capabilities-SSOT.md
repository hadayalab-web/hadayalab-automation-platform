# n8n MCP Access Token 機能と制限 SSOT（Single Source of Truth）

**最終更新**: 2025-01-24
**最終検証**: 2025-01-24（公式ドキュメントとコミュニティフォーラム）
**バージョン**: 1.0.0
**メンテナー**: HadayaLab

---

## 📚 公式リファレンス

- **公式ドキュメント**: [Accessing n8n MCP server](https://docs.n8n.io/advanced-ai/accessing-n8n-mcp-server/)
- **コミュニティフォーラム**: [Introducing Instance-Level MCP Access in n8n (Beta)](https://community.n8n.io/t/introducing-instance-level-mcp-access-in-n8n-beta/223178)

---

## ✅ MCP Access Tokenでできること

### 1. ワークフローの検索

- **機能**: MCPアクセスが有効化されたワークフローを検索
- **ツール**: `mcp_n8n_search_workflows`
- **パラメータ**:
  - `query`: 検索クエリ（オプション）
  - `limit`: 結果数の上限（デフォルト: 10、最大: 200）
  - `projectId`: プロジェクトID（オプション）
- **制限**: MCPアクセスが有効化されたワークフローのみ検索可能

### 2. ワークフローの詳細情報取得

- **機能**: ワークフローのメタデータ、ノード、接続、トリガー情報を取得
- **ツール**: `mcp_n8n_get_workflow_details`
- **パラメータ**:
  - `workflowId`: ワークフローID（必須）
- **取得可能な情報**:
  - ワークフロー名、説明、状態
  - ノード一覧と接続情報
  - トリガー情報（Webhook URL、HTTPメソッドなど）
  - 設定（`availableInMCP`など）

### 3. ワークフローの実行

- **機能**: 適切なトリガーが設定されたワークフローを実行
- **ツール**: `mcp_n8n_execute_workflow`
- **パラメータ**:
  - `workflowId`: ワークフローID（必須）
  - `inputs`: 入力データ（必須）
    - `type`: `"chat"`, `"form"`, `"webhook"`のいずれか
    - タイプに応じた入力データ
- **対応トリガー**:
  - ✅ Webhook Trigger
  - ✅ Schedule Trigger
  - ✅ Chat Trigger
  - ✅ Form Trigger
- **制限**: 実行タイムアウトは5分

### 4. 実行履歴の確認

- **機能**: ワークフローの実行履歴を詳細に確認
- **取得可能な情報**:
  - 実行結果
  - エラー情報
  - 実行時間
  - 実行ステータス

### 5. 環境変数の管理

- **機能**: n8n Cloudの環境変数を管理
- **操作**:
  - 環境変数の取得
  - 環境変数の設定
  - 環境変数の削除

---

## ❌ MCP Access Tokenでできないこと

### 1. ワークフローの作成

- **理由**: MCP Access Tokenはワークフローの実行に特化
- **代替方法**:
  - n8n Dashboardから手動作成
  - n8n-mcpパッケージを使用（ただし、Personal Access Tokenが必要で現在存在しない）

### 2. ワークフローの編集・更新

- **理由**: ワークフローの編集機能は提供されていない
- **代替方法**:
  - n8n Dashboardから手動編集
  - n8n-mcpパッケージを使用（ただし、Personal Access Tokenが必要で現在存在しない）

### 3. ワークフローの削除

- **理由**: ワークフロー削除機能は提供されていない
- **代替方法**:
  - n8n Dashboardから手動削除
  - REST APIを使用（ただし、Personal Access Tokenが必要で現在存在しない）

### 4. REST APIへのアクセス

- **理由**: MCP Access TokenはMCPプロトコル専用
- **結果**: REST APIでは使用不可（401 Unauthorizedエラーが返される）
- **影響**:
  - REST APIエンドポイント（`/rest/workflows`など）にアクセスできない
  - Personal Access Tokenが必要な操作は実行できない

### 5. 全ワークフローへの自動アクセス

- **理由**: 各ワークフローごとにMCPアクセスを有効化する必要がある
- **影響**: MCP Access Tokenを使用しても、すべてのワークフローに自動的にアクセスできるわけではない
- **設定**: ワークフロー設定で「Available in MCP」を有効化する必要がある

### 6. クライアントごとのアクセス制限

- **制限**: 現在、MCP Access Tokenは特定のクライアントごとにアクセスを制限する機能を提供していない
- **影響**: 接続されたすべてのクライアントは、MCPアクセスが有効化されたすべてのワークフローを閲覧できる

### 7. ノード検索

- **理由**: ノード検索機能は提供されていない
- **代替方法**: n8n-mcpパッケージの`list_node_templates`を使用（ただし、Personal Access Tokenが必要で現在存在しない）

### 8. テンプレート検索

- **理由**: テンプレート検索機能は提供されていない
- **代替方法**: n8n-mcpパッケージの`search_templates`を使用（ただし、Personal Access Tokenが必要で現在存在しない）

### 9. ワークフロー検証

- **理由**: ワークフロー検証機能は提供されていない
- **代替方法**: n8n-mcpパッケージの`validate_workflow`を使用（ただし、Personal Access Tokenが必要で現在存在しない）

---

## ⚠️ 重要な制限事項

### 1. ワークフローの公開条件

MCPクライアントからアクセス可能にするには、ワークフローが以下の条件を満たす必要があります：

- ✅ ワークフローが**公開済み**であること
- ✅ 以下のいずれかのトリガーノードを含むこと：
  - Webhook Trigger
  - Schedule Trigger
  - Chat Trigger
  - Form Trigger
- ✅ ワークフロー設定で「**Available in MCP**」が有効になっていること

### 2. 実行タイムアウト

- **制限**: MCPクライアントからトリガーされたワークフローは、**5分のタイムアウト**が適用されます
- **影響**: 5分以内に完了しない場合、n8nは実行を停止し、エラーを返します
- **注意**: この制限は、ワークフロー設定で設定されたタイムアウトよりも優先されます

### 3. 入力データの制限

- **制限**: MCPクライアントは、ワークフローに対して**テキストベースの入力のみ**を提供できます
- **影響**: バイナリデータ（画像、ファイルなど）の入力はサポートされていません

### 4. 複数トリガーの制限

- **制限**: ワークフローに複数のサポートされているトリガーノードが含まれている場合、MCPクライアントは**最初のトリガーのみ**を使用してワークフローをトリガーする可能性があります

### 5. 人間の介入が必要なワークフロー

- **制限**: 複数ステップのフォームや人間の介入が必要なワークフローの実行はサポートされていません
- **影響**: このようなワークフローは、MCP経由で実行できません

### 6. REST APIとの互換性

- **制限**: MCP Access Tokenは、**MCPプロトコル経由でのアクセスのみ**に使用できます
- **影響**: REST APIでは使用できません（401エラーが返されます）
- **代替方法**: REST APIを使用する場合は、Personal Access Tokenが必要ですが、現在存在しません

---

## 🔐 認証とセキュリティ

### MCP Access Tokenの取得

1. n8n Cloud Dashboard → **Settings** → **MCP Access**
2. **「Access Token」タブ**をクリック
3. 表示されるTokenをコピー（マスクされている場合は、リフレッシュアイコンで再生成）
4. `mcp.json`の`authorization:Bearer`の後に設定

### セキュリティのベストプラクティス

1. **トークンの保護**
   - ✅ トークンをGitにコミットしない（`.gitignore`に追加）
   - ✅ 環境変数やシークレット管理ツール（Infisicalなど）で管理
   - ✅ トークンを平文で保存しない

2. **トークンのローテーション**
   - ✅ 定期的にトークンを更新（推奨: 3-6ヶ月ごと）
   - ✅ 不要になったトークンは速やかに無効化
   - ✅ 漏洩が疑われる場合は即座に無効化

3. **アクセス制御**
   - ✅ 必要なワークフローのみMCPアクセスを有効化
   - ✅ 機密情報を含むワークフローはMCPアクセスを無効化

---

## 📊 機能比較表

| 機能 | MCP Access Token | Personal Access Token | 備考 |
|------|-----------------|---------------------|------|
| **ワークフロー検索** | ✅ | ✅ | MCP Access TokenはMCPプロトコル経由のみ |
| **ワークフロー詳細取得** | ✅ | ✅ | MCP Access TokenはMCPプロトコル経由のみ |
| **ワークフロー実行** | ✅ | ❌ | MCP Access Tokenのみ可能 |
| **ワークフロー作成** | ❌ | ✅ | Personal Access Tokenは現在存在しない |
| **ワークフロー更新** | ❌ | ✅ | Personal Access Tokenは現在存在しない |
| **ワークフロー削除** | ❌ | ✅ | Personal Access Tokenは現在存在しない |
| **実行履歴確認** | ✅ | ⚠️ 基本のみ | MCP Access Tokenが詳細 |
| **環境変数管理** | ✅ | ❌ | MCP Access Tokenのみ可能 |
| **REST APIアクセス** | ❌ | ✅ | Personal Access Tokenは現在存在しない |
| **ノード検索** | ❌ | ✅ | Personal Access Tokenは現在存在しない |
| **テンプレート検索** | ❌ | ✅ | Personal Access Tokenは現在存在しない |

---

## 🎯 使い分けガイド

### MCP Access Tokenを使用する場合

- ✅ **ワークフローの実行**
  - Webhook Triggerのワークフローを実行
  - スケジュールTriggerのワークフローを実行
  - Chat Triggerのワークフローを実行
  - Form Triggerのワークフローを実行

- ✅ **実行履歴の詳細確認**
  - 実行結果の詳細を確認
  - エラー情報の確認
  - 実行時間の確認

- ✅ **環境変数の管理**
  - 環境変数の取得
  - 環境変数の設定
  - 環境変数の削除

- ✅ **ワークフローの検索・詳細取得**
  - MCPアクセスが有効化されたワークフローの検索
  - ワークフローの詳細情報取得

### MCP Access Tokenではできない場合

- ❌ **ワークフローの作成・編集・削除**
  - n8n Dashboardから手動で実行する必要がある
  - または、Personal Access Tokenが必要（現在存在しない）

- ❌ **REST APIへのアクセス**
  - Personal Access Tokenが必要（現在存在しない）

- ❌ **ノード検索・テンプレート検索**
  - Personal Access Tokenが必要（現在存在しない）

---

## 📝 まとめ

### MCP Access Tokenの特徴

1. **MCPプロトコル専用**: REST APIでは使用不可
2. **ワークフロー実行に特化**: 作成・編集・削除は不可
3. **環境変数管理可能**: 取得・設定・削除が可能
4. **実行履歴の詳細確認**: 詳細な実行情報を取得可能
5. **制限事項**: 5分のタイムアウト、テキスト入力のみ、公開ワークフローのみ

### 現在の状況

- ✅ **MCP Access Token**: 使用可能（MCPプロトコル経由）
- ❌ **Personal Access Token**: 存在しない（REST APIは使用不可）
- ❌ **N8N_API_KEY**: 存在しない

### 推奨事項

1. **ワークフローの実行**: MCP Access Tokenを使用
2. **ワークフローの作成・編集・削除**: n8n Dashboardから手動で実行
3. **環境変数の管理**: MCP Access Tokenを使用
4. **実行履歴の確認**: MCP Access Tokenを使用

---

## 🔄 更新履歴

### 2025-01-24 (v1.0.0)
- 初版作成
- 公式ドキュメントとコミュニティフォーラムの情報を基に、MCP Access Tokenの機能と制限を徹底調査
- REST APIとの互換性について明確化
- セキュリティのベストプラクティスを追加

---

**このドキュメントは、n8n MCP Access Tokenの機能と制限に関する唯一の信頼できる情報源（SSOT）です。**














