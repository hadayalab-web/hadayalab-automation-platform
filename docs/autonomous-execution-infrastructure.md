# 🤖 自律実行型インフラ設計

## 📋 概要

このドキュメントは、「高レベルな指示から自動実行し、意思決定が必要な時だけ人間に確認を求める」自律実行型インフラの設計を定義します。

### 設計原則

```yaml
1. 高レベル指示から自動実行
   - 例: "1週間で200万作りたい、ワークフロー回してくれ"
   - → 自動的に必要なワークフローを実行

2. 意思決定が必要な時だけ人間に確認
   - 例: 予算超過、新規API統合、戦略変更
   - → 人間の判断を仰ぐ

3. 自動最適化と学習
   - 実行結果から学習
   - パフォーマンス改善を自動実施
```

---

## 🎯 高レベル指示の解釈と実行

### 指示例と実行マッピング

#### 例1: 「1週間で200万作りたい、ワークフロー回してくれ」

```yaml
指示解析:
  目標: 200万円/週
  期間: 7日間
  アクション: ワークフロー実行

自動実行フロー:
  1. 目標分解
     - 200万円 ÷ 7日 = 約28.6万円/日
     - 現在のARPU（Average Revenue Per User）を取得
     - 必要な新規顧客数を計算

  2. ワークフロー選択
     - Trial Onboarding Automation（新規顧客獲得）
     - Affiliate DRM Cold Outreach（アフィリエイター獲得）
     - X Briefing Share（ブランド認知向上）

  3. 実行パラメータ設定
     - Cold Outreach: 1日50件 → 7日で350件
     - Trial開始目標: 1日20件 → 7日で140件
     - コンバージョン率: 15% → 21件/日 → 147件/週

  4. 自動実行
     - 各ワークフローをスケジュール実行
     - 進捗監視
     - 目標未達時は自動調整

  5. 意思決定ポイント
     - 予算超過の可能性 → 人間に確認
     - API Rate Limit到達 → 人間に確認
     - 異常なコンバージョン率 → 人間に確認
```

#### 例2: 「今月の売上を前月比20%増やしてくれ」

```yaml
指示解析:
  目標: 前月比+20%
  期間: 1ヶ月
  アクション: 売上増加

自動実行フロー:
  1. 前月データ取得
     - Whop APIから前月売上取得
     - 顧客数、ARPU、コンバージョン率を分析

  2. 目標設定
     - 前月売上 × 1.2 = 目標売上
     - 必要な新規顧客数計算
     - リテンション率改善目標設定

  3. ワークフロー最適化
     - Email Sequence改善（A/Bテスト）
     - Affiliate Tier調整（インセンティブ強化）
     - VSL更新（コンバージョン率向上）

  4. 自動実行
     - 最適化されたワークフロー実行
     - 週次進捗確認
     - 目標未達時は自動調整

  5. 意思決定ポイント
     - 大幅な戦略変更が必要 → 人間に確認
     - 予算超過 → 人間に確認
```

---

## 🔄 自律実行ワークフロー設計

### 1. Goal Parser Workflow（目標解析ワークフロー）

```yaml
トリガー: Webhook / Manual
入力: 高レベル指示（自然言語）

処理:
  1. 自然言語解析
     - 目標金額抽出
     - 期間抽出
     - アクション抽出

  2. 現在状態取得
     - Whop API: 現在の売上、顧客数
     - Google Sheets: 過去のパフォーマンス
     - n8n Executions: ワークフロー実行状況

  3. 目標分解
     - 日次目標計算
     - 必要なアクション数計算
     - リソース必要量計算

  4. ワークフロー選択
     - 目標に最適なワークフローを選択
     - 実行順序決定
     - パラメータ設定

  5. 実行計画生成
     - 実行スケジュール
     - 予算見積もり
     - リスク評価

  6. 意思決定チェック
     - 予算超過 → 人間に確認
     - 新規API統合必要 → 人間に確認
     - 異常値検出 → 人間に確認

  7. 自動実行 or 人間確認待ち
     - 自動実行可能 → 即実行
     - 人間確認必要 → 通知送信
```

### 2. Auto Execution Orchestrator（自動実行オーケストレーター）

```yaml
トリガー: Goal Parser Workflow完了

処理:
  1. ワークフロー実行
     - 選択されたワークフローを順次実行
     - 並列実行可能なものは並列実行

  2. 進捗監視
     - リアルタイム進捗取得
     - 目標達成率計算
     - 予測達成日計算

  3. 自動調整
     - 目標未達 → パラメータ調整
     - 目標超過 → リソース最適化
     - エラー発生 → 自動リトライ

  4. レポート生成
     - 日次レポート
     - 週次レポート
     - 目標達成時レポート

  5. 意思決定ポイント
     - 大幅な目標未達 → 人間に確認
     - 予算超過 → 人間に確認
     - 異常なパフォーマンス → 人間に確認
```

### 3. Decision Point Handler（意思決定ポイントハンドラー）

```yaml
トリガー: 意思決定が必要な状況検出

処理:
  1. 状況分析
     - 問題の種類判定
     - 影響範囲評価
     - 緊急度評価

  2. 提案生成
     - 複数の選択肢提示
     - 各選択肢の影響分析
     - 推奨案提示

  3. 人間への通知
     - Telegram通知
     - Email通知
     - ダッシュボード更新

  4. 人間の判断待ち
     - タイムアウト設定（24時間）
     - リマインダー送信

  5. 判断反映
     - 人間の判断を取得
     - ワークフローに反映
     - 実行再開
```

---

## 📊 意思決定ポイント一覧

### 自動実行可能（人間確認不要）

```yaml
✅ 既存ワークフローの実行
✅ パラメータの微調整（±10%以内）
✅ スケジュール実行
✅ データ取得・更新
✅ レポート生成
✅ エラー自動リトライ（3回以内）
```

### 人間確認必要

```yaml
⚠️ 予算超過の可能性（10%超過）
⚠️ 新規API統合
⚠️ ワークフロー新規作成
⚠️ 戦略的大きな変更（±20%以上）
⚠️ 異常なパフォーマンス（標準偏差3σ以上）
⚠️ セキュリティ関連の変更
⚠️ 顧客データの大量削除
⚠️ 外部サービスへの大規模送信
```

---

## 🔧 実装要件

### n8nワークフロー実装

```yaml
1. workflow-goal-parser.json
   - 高レベル指示の解析
   - 目標分解
   - ワークフロー選択

2. workflow-auto-executor.json
   - ワークフロー自動実行
   - 進捗監視
   - 自動調整

3. workflow-decision-handler.json
   - 意思決定ポイント検出
   - 人間への通知
   - 判断反映

4. workflow-performance-monitor.json
   - パフォーマンス監視
   - 異常検出
   - 自動最適化
```

### データストア

```yaml
Google Sheets:
  - goals_tracker: 目標と進捗
  - decision_log: 意思決定ログ
  - performance_metrics: パフォーマンス指標

n8n Variables:
  - AUTO_EXECUTION_ENABLED: true/false
  - BUDGET_LIMIT: 予算上限
  - DECISION_TIMEOUT: 24時間
```

### API統合

```yaml
必須:
  - Whop API: 売上・顧客データ取得
  - Google Sheets API: データ管理
  - Telegram Bot API: 通知送信
  - n8n API: ワークフロー制御

オプション:
  - OpenAI API: 自然言語解析
  - Anthropic API: 意思決定支援
```

---

## 🚀 使用例

### 例1: 「1週間で200万作りたい」

```bash
# Cursor Chatから実行
「1週間で200万作りたい、ワークフロー回してくれ」

→ Goal Parser Workflow実行
→ 目標分解: 28.6万円/日
→ ワークフロー選択: Trial Onboarding, Cold Outreach, X Share
→ 自動実行開始
→ 進捗監視開始
→ 日次レポート送信
```

### 例2: 「今月の売上を前月比20%増やしてくれ」

```bash
# Cursor Chatから実行
「今月の売上を前月比20%増やしてくれ」

→ Goal Parser Workflow実行
→ 前月データ取得
→ 目標設定: 前月 × 1.2
→ ワークフロー最適化
→ 自動実行開始
→ 週次進捗確認
```

### 例3: 意思決定が必要な場合

```bash
# 自動実行中に検出
「予算超過の可能性が検出されました（15%超過見込み）」

→ Decision Point Handler実行
→ Telegram通知送信
→ 選択肢提示:
   1. 予算上限を引き上げる（+15%）
   2. 実行を縮小する（-10%）
   3. 現状維持（リスクあり）

→ 人間の判断待ち
→ 判断反映
→ 実行継続
```

---

## 📈 パフォーマンス指標

### 監視項目

```yaml
実行効率:
  - 目標達成率
  - 実行時間
  - リソース使用率

意思決定:
  - 人間確認回数
  - 判断時間
  - 自動実行率

最適化:
  - パラメータ調整回数
  - 改善効果
  - 学習速度
```

---

## 🔒 セキュリティとリスク管理

### 自動実行制限

```yaml
予算制限:
  - 日次予算上限
  - 週次予算上限
  - 月次予算上限

実行制限:
  - 最大同時実行数
  - 最大リトライ回数
  - 最大実行時間

データ保護:
  - 顧客データの自動削除禁止
  - 大量送信の事前確認
  - セキュリティ設定変更の事前確認
```

---

## 📚 参考資料

- [n8n Workflow API](https://docs.n8n.io/api/)
- [Google Sheets API](https://developers.google.com/sheets/api)
- [Whop API](https://docs.whop.com/api-reference)

---

**作成日**: 2025-12-25
**バージョン**: 1.0
**ステータス**: 設計完了




